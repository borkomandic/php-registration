
# PHP User Registration System

This project implements a user registration system in PHP, following the S.O.L.I.D principles for object-oriented design and using Composer for class autoloading with PSR-4. It demonstrates a basic yet extendable architecture without relying on a full-fledged framework.

## Project Structure

```plaintext
project-root/
├── src/
│   ├── Controller/
│   │   └── RegistrationController.php
│   │
│   ├── Model/
│   │   ├── User.php (Not implemented in examples)
│   │   └── UserLog.php (Not implemented in examples)
│   │
│   ├── Service/
│   │   ├── EmailService.php (Not implemented in examples)
│   │   ├── RegistrationService.php
│   │   └── Validation/
│   │       ├── ValidatorInterface.php
│   │       ├── EmailValidator.php
│   │       ├── PasswordValidator.php
│   │       └── ValidatorComposite.php
│   │
│   ├── Repository/
│   │   └── UserRepository.php
│   │
│   └── Utils/
│       └── Database.php
│
├── vendor/ (Auto-generated by Composer)
│
├── composer.json
│
└── public/
    └── index.php
```

### src/ Directory

Contains the application logic, structured into models, controllers, services, repositories, and utilities.

#### Controller/

- `RegistrationController.php`: Manages incoming HTTP requests and coordinates user registration through the registration service.

#### Model/

- `User.php`: Represents the user entity (not detailed here).
- `UserLog.php`: Represents the user log entity (not detailed here).

#### Service/

- `RegistrationService.php`: Orchestrates the registration process, utilizing validators and repositories.
- Validation/:
  - `ValidatorInterface.php`: Defines the contract for validators.
  - `EmailValidator.php`: Validates email addresses on the basic level.
  - `MaxMindValidator.php`: Validates email addresses, including uniqueness and external checks via Maxmind.
  - `PasswordValidator.php`: Validates password rules and matches.
  - `ValidatorComposite.php`: Combines multiple validators into a single composite validator.

#### Repository/

- `UserRepository.php`: Handles database operations related to users, such as finding and inserting users and logs.

#### Utils/

- `Database.php`: Manages database connections and queries.

### vendor/ Directory

Contains all Composer-managed dependencies, including the autoloader.

### composer.json

Defines project dependencies and autoloading configuration.

### public/ Directory

Contains the public entry point to the application.

- `index.php`: Initializes the application and handles incoming requests.

## Installation

1. Clone the repository.
2. Run `docker compose up` from within the cloned folder. Composer dependencies will 
install automatically from en entrypoint script of apache.

## Usage

Navigate to localhost/registration. The application expects POST requests with `email`, `password`, and `password2` parameters for user registration.

## Sandbox Testing

To perform sandbox run of MaxMind verification:

1. Use `sandbox.maxmind.com` for your MaxMind requests.
- For `MaxMindVendorValidator.php` use `$mf = new MinFraud($_ENV['MAX_MIND_ID'], $_ENV['MAX_MIND_KEY'], ['host' => 'sandbox.maxmind.com'])`
- For `MaxMindCustomValidator.php` no changes required, just change api url domain in `.env`

2. Use hardcoded IPs for different MaxMind scores.
- `128.101.101.101`: for score 40-90
- `74.209.24.1`: for score 5-39.99
- `65.116.3.80`: for score 0.01-4.99

## Extending the System

- Implement additional validators by creating new classes that implement `ValidatorInterface` and adding them to the `ValidatorComposite` in `RegistrationService`.
- Extend `UserRepository` for additional database operations as needed.
- Add new models in the `Model/` directory for other entities.

## Environment Configuration

This project uses environmental variables for configuration settings such as database connections. To set up your environment variables:

- Edit the `.env` file to include your specific configuration values, such as MaxMind credentials & settings.

### Example .env File

```plaintext
MYSQL_HOST=db
MYSQL_ROOT_PASSWORD=my_secret_password
MYSQL_DATABASE=my_db
MYSQL_USER=my_user
MYSQL_PASSWORD=my_password
MAX_MIND_CUSTOM_VALIDATOR_ENABLED=0
MAX_MIND_VENDOR_VALIDATOR_ENABLED=0
MAX_MIND_ID=994378
MAX_MIND_KEY=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
MAX_MIND_RISK_LIMIT=50
MAX_MIND_SCORE_API_URL=https://minfraud.maxmind.com/minfraud/v2.0/score
```

Consider adding `.env` to your `.gitignore` file to prevent sensitive information from being exposed publicly.
